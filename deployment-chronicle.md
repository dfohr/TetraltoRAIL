# TetraltoRail Deployment Chronicle

This document tracks our deployment process, challenges encountered, and solutions implemented for the TetraltoRail project.

## Project Overview

- **Project Name**: TetraltoRail
- **Main Application**: TetraltoDjango
- **Deployment Platform**: Railway.app
- **Repository**: [TetraltoRAIL on GitHub](https://github.com/dfohr/TetraltoRAIL)

## Deployment History

### May 2023 - Initial Deployment

_Initial deployment details to be filled in..._

## Deployment Challenges and Solutions

### May 2023 - Railway CLI Upload Size Limitations

**Issue**: 
When attempting to deploy using `railway up`, we encountered timeout errors. Investigation revealed our project size is approximately 117MB, which exceeds Railway's 45MB upload limit for direct deployments.

**Project Size Analysis**:
- Total project size: 117MB
- Static files: 57MB (primarily large blog images)
- Staticfiles directory: 59MB (duplicates of static files generated by collectstatic)

**Solution**:
Switching to GitHub-based deployments to:
1. Only deploy changed files, bypassing the 45MB limit
2. Improve deployment reliability
3. Maintain better version control and rollback capabilities

**Next Steps**:
1. Connect the GitHub repository to Railway
2. Configure proper deployment settings in Railway dashboard
3. Consider moving large static assets to a CDN in the future
4. Optimize image files to reduce overall project size

### May 2023 - SSH Access and Name Collision Issues

**Issue**:
We encountered difficulties establishing SSH access to our Railway deployment. Initial attempts to connect via SSH failed, and we suspected configuration issues with the service.

**Investigation**:
After multiple troubleshooting attempts, we identified that a name collision between our service configurations was causing the problem. The build process was getting confused by conflicting configuration files or service names.

**Solution**:
1. Removed problematic pre-deploy commands from our configuration
2. Simplified the deployment configuration to avoid name collisions
3. Switched from Railpack to Nixpacks as the builder, which provided a more standardized build process
4. Ensured consistent naming across all configuration files and environment variables

**Result**:
Successfully established SSH access to the deployed application, which provides:
1. Direct troubleshooting capabilities in the production environment
2. Ability to examine logs and file structures in real-time
3. Option to perform emergency fixes when needed
4. Better visibility into how our application is running in production

**Lessons Learned**:
Consistent naming and simplified configuration are crucial for Railway deployments. When multiple configuration approaches overlap (like mixing Railpack and Nixpacks configurations), Railway may experience conflicts that prevent proper service execution and SSH access.

## Future Considerations for Microservices Architecture

As we plan to transition to a microservices architecture:

1. GitHub-based deployments will allow independent deployment of each service
2. Only changed services will be rebuilt and deployed
3. Individual services can have their own CI/CD workflows
4. Storage solutions for static assets will need to be implemented across services

## Deployment Environment Variables

| Variable Name | Purpose | Set In |
|---------------|---------|--------|
| RAILPACK_DJANGO_APP_NAME | Specifies the WSGI application | Railway Dashboard |
| RAILPACK_DJANGO_WORKDIR | Sets the working directory | Railway Dashboard |
| DATABASE_URL | Connection string for PostgreSQL | Railway Dashboard |
| DJANGO_SECRET_KEY | Secret key for Django | Railway Dashboard |
| DJANGO_DEBUG | Enable/disable debug mode | Railway Dashboard |

## Deployment Commands and Processes

**GitHub-based Deployment**:
1. Push changes to the GitHub repository
2. Railway automatically detects changes and rebuilds the service
3. Deployment logs can be viewed in the Railway dashboard

**Manual Deployment (for reference)**:
```bash
# This no longer works due to size limitations
railway up
```

**SSH Access**:
```bash
# Connect to the deployed service
railway ssh
``` 