{% extends 'base.html' %}
{% load static %}
{% load testimonial_tags %}
{% load service_tags %}

{% block title %}Missouri City TX Roofing Contractors | Expert Roof Repair & Replacement{% endblock %}

{% block meta_description %}Top-rated roofing Missouri City TX. Tetralto offers roof replacement, repair & gutter services. Free estimates! Call 281-895-1213 today.{% endblock %}

{% block og_description %}Top-rated roofing Missouri City TX. Tetralto offers roof replacement, repair & gutter services. Free estimates! Call 281-895-1213 today.{% endblock %}

{% block twitter_description %}Top-rated roofing Missouri City TX. Tetralto offers roof replacement, repair & gutter services. Free estimates! Call 281-895-1213 today.{% endblock %}

{% block content %}
<!-- Hidden SEO Data Block for Featured Testimonials -->
<div class="reviews-data" hidden>
    <script type="application/ld+json">
{% testimonials_jsonld_seo %}
    </script>
</div>

<!-- Hero Image Section -->
<section class="hero-image-section">
    <div class="hero-overlay">
        <div class="hero-content-grid">
                <!-- Left Column: Text Content -->
                <div class="hero-text">
                    <p class="hero-intro">We are the</p>
                    
                    <div class="hero-title-container">
                        <span class="hero-title-text">Trusted Roofing Experts</span>
                    </div>
                    
                    <p class="hero-location">in Missouri City, Sienna, Sugar Land and surrounding areas.</p>
                    
                    <p class="hero-description">We use</p>
                    <p class="hero-description"><span class="highlight-orange">Science and Advanced Tools</span></p>
                    <p class="hero-description">to inspect your roof.</p>
                    
                    <p class="hero-description">We share</p>
                    <p class="hero-description"><span class="highlight-orange">Clear, Honest, Results</span></p>
                    <p class="hero-description">and design tailored solutions.</p>
                    
                    <p class="hero-description">And - we don't use gimmicky or high-pressure sales tactics.</p>
                </div>
                
                <!-- Right Column: Contact Form -->
                <div class="hero-form-column">
                    <div class="hero-form">
                        <div class="form-container">
                            <h3>Get Your Free Roof Inspection</h3>
                            
                            <!-- Display Django messages -->
                            {% if messages %}
                                {% for message in messages %}
                                    <div class="alert alert-{{ message.tags }}">
                                        {{ message }}
                                    </div>
                                {% endfor %}
                            {% endif %}
                            
                            <!-- Display form errors -->
                            {% if form.errors %}
                                <div class="alert alert-error">
                                    <strong>Please correct the following errors:</strong>
                                    {% for field, errors in form.errors.items %}
                                        {% for error in errors %}
                                            <div>{{ field|title }}: {{ error }}</div>
                                        {% endfor %}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            
                            <!-- Use reusable form component -->
                            {% include '_lead_form.html' with form=form variant='contact' submit_text='Send' recaptcha_action='contact_form' show_disclaimer=False %}
                        </div>
                    </div>
                </div>
            </div>
    </div>
</section>


<section id="services" class="service-tiles-section">
    <div class="service-tiles-content">
        <p style="font-size: 1rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Our Services</p>
        <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 2rem;">
            Our <span class="highlight-orange">Roofing Services</span> for Southwest Houston
        </h2>
        
        <div class="service-tiles-grid">
            {% service_tile "roof-replacement" %}
            {% service_tile "roof-repair" %}
            {% service_tile "gutter" %}
        </div>
    </div>
</section>


<!-- Video Section -->
<section class="video-section" id="video-section">
    <div class="container">
        <div class="video-wrapper">
            <iframe
                id="youtube-video"
                src="https://www.youtube.com/embed/xFFKumtpqTo?enablejsapi=1&mute=1"
                title="YouTube video player"
                width="1120"
                height="630"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                referrerpolicy="strict-origin-when-cross-origin"
                allowfullscreen>
            </iframe>
        </div>
    </div>
</section>

<script>
// Autoplay video when scrolled into view (plays only once)
(function() {
    const videoSection = document.getElementById('video-section');
    const videoIframe = document.getElementById('youtube-video');
    let hasPlayed = false;

    const observerOptions = {
        root: null, // Use viewport
        rootMargin: '0px',
        threshold: 0.5 // 50% of video must be visible
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting && !hasPlayed) {
                // Video is in view for the first time - trigger autoplay
                const currentSrc = videoIframe.src;
                // Add autoplay=1 to the URL
                if (!currentSrc.includes('autoplay=1')) {
                    videoIframe.src = currentSrc + '&autoplay=1';
                    hasPlayed = true;
                }
            }
        });
    }, observerOptions);

    observer.observe(videoSection);
})();
</script>

<!-- Features Section -->
<section class="features">
    <div class="container">
        <h2>The Things That Make Us Great!</h2>
        <p class="subtitle">What sets us apart from other roofing companies? Here are the reasons why homeowners choose Tetralto Roofing.</p>
        
        <div class="features-grid">
            {% for feature in features %}
            <div class="feature-card">
                <div class="feature-icon">
                    <img src="{% static 'images/'|add:feature.icon_filename %}" alt="{{ feature.title }} icon">
                </div>
                <h3>{{ feature.title }}</h3>
                <p>{{ feature.description }}</p>
            </div>
            {% endfor %}
        </div>

        <div class="features-cta">
            <h2>Ready to Experience the Tetralto Difference?</h2>
            <div class="button-group">
                <a href="tel:+12818951213" class="button primary">Call (281) 895-1213</a>
                <a href="{% url 'contact' %}" class="button secondary">Get Free Estimate</a>
            </div>
        </div>
    </div>
</section>

<!-- Testimonials Section -->
<section class="testimonials">
    <div class="container">
        <h2>What Our Customers Say</h2>
        {% testimonials_carousel carousel_id="testimonials-carousel" %}
    </div>
</section>

{% include '_social_bar.html' %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Execute reCAPTCHA when page loads
    grecaptcha.ready(function() {
        grecaptcha.execute('{{ settings.RECAPTCHA_PUBLIC_KEY }}', {action: 'contact_form'})
        .then(function(token) {
            // Set the token in the hidden field
            var recaptchaField = document.getElementById('id_g_recaptcha_response');
            if (recaptchaField) {
                recaptchaField.value = token;
            }
        });
    });
    
    // Re-execute reCAPTCHA before form submission
    var form = document.querySelector('.contact-form');
    if (form) {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            grecaptcha.ready(function() {
                grecaptcha.execute('{{ settings.RECAPTCHA_PUBLIC_KEY }}', {action: 'contact_form'})
                .then(function(token) {
                    // Set the fresh token
                    var recaptchaField = document.getElementById('id_g_recaptcha_response');
                    if (recaptchaField) {
                        recaptchaField.value = token;
                    }
                    
                    // Submit the form
                    form.submit();
                });
            });
        });
    }
});
</script>
{% endblock %} 